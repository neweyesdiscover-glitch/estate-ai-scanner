<!DOCTYPE html>
<html>
<head>
    <title>Estate AI Scanner</title>

    <style>
        body{
            font-family: Arial;
            padding:40px;
            max-width:900px;
            margin:auto;
        }

        h1{
            margin-bottom:5px;
        }

        .row{
            display:flex;
            gap:30px;
            margin-top:20px;
            align-items:flex-start;
        }

        .panel{
            border:1px solid #ddd;
            border-radius:10px;
            padding:15px;
        }

        .preview{
            width:320px;
        }

        .preview img{
            max-width:100%;
            border-radius:8px;
            border:1px solid #ddd;
            margin-top:10px;
            display:none;
        }

        .result{
            flex:1;
        }

        .line{
            margin:6px 0;
            line-height:1.3;
        }

        button{
            padding:10px 18px;
            border-radius:6px;
            border:none;
            background:#2b7cff;
            color:white;
            font-weight:bold;
            cursor:pointer;
        }

        button:hover{
            background:#1f5ed6;
        }

        .status{
            font-size:12px;
            color:#666;
            margin-bottom:8px;
        }
    </style>
</head>


<body>

<h1>Estate AI Scanner</h1>
<p>Upload an item and get an instant resale estimate.</p>

<input type="file" id="fileInput" accept="image/*">
<button onclick="upload()">Analyze</button>

<div class="row">

    <div class="panel preview">
        <h3>Preview</h3>
        <img id="previewImg">
    </div>

    <div class="panel result">
        <h3>Result</h3>
        <div id="status" class="status"></div>
        <div id="result"></div>
    </div>

</div>



<script>

const fileInput = document.getElementById("fileInput");
const previewImg = document.getElementById("previewImg");
const resultEl = document.getElementById("result");
const statusEl = document.getElementById("status");


// IMAGE PREVIEW
fileInput.addEventListener("change", () => {

    const file = fileInput.files[0];

    if(!file) return;

    previewImg.src = URL.createObjectURL(file);
    previewImg.style.display = "block";

    resultEl.innerHTML = "";
    statusEl.innerText = "";
});



async function upload(){

    const file = fileInput.files[0];

    if(!file){
        alert("Choose an image first.");
        return;
    }

    statusEl.innerText = "Analyzing... (first scan may take ~30 seconds if server is waking up)";

    const formData = new FormData();
    formData.append("file", file);


    try{

        // ✅ RELATIVE PATH — WORKS LOCALLY + ON RENDER
        const response = await fetch("/analyze-image", {
            method:"POST",
            body:formData
        });

        const data = await response.json();

        statusEl.innerText = "Done ✅";

        if(data.error){
            resultEl.innerHTML = `<div class="line"><b>Error:</b> ${data.error}</div>`;
            return;
        }

        resultEl.innerHTML = `
            <div class="line"><b>Item:</b> ${data.item_name || ""}</div>
            <div class="line"><b>Brand / Origin:</b> ${data.brand_or_origin || ""}</div>
            <div class="line"><b>Estimated Value:</b> ${data.estimated_value_range || ""}</div>
            <div class="line"><b>Suggested Price:</b> ${data.suggested_listing_price || ""}</div>
            <div class="line"><b>Condition:</b> ${data.condition_assumptions || ""}</div>
            <div class="line"><b>Keywords:</b> ${data.keywords_for_listing || ""}</div>
            <div class="line"><b>Pricing Sources:</b> ${data.pricing_sources || ""}</div>
        `;

    }
    catch(err){

        statusEl.innerText = "";
        resultEl.innerHTML = `<div class="line"><b>Connection Error:</b> Could not reach AI server.</div>`;

    }

}

</script>

</body>
</html>
